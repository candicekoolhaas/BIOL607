<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Koolhaas_Candice_6_2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Koolhaas_Candice_3_2025_files/libs/clipboard/clipboard.min.js"></script>
<script src="Koolhaas_Candice_3_2025_files/libs/quarto-html/quarto.js"></script>
<script src="Koolhaas_Candice_3_2025_files/libs/quarto-html/popper.min.js"></script>
<script src="Koolhaas_Candice_3_2025_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Koolhaas_Candice_3_2025_files/libs/quarto-html/anchor.min.js"></script>
<link href="Koolhaas_Candice_3_2025_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Koolhaas_Candice_3_2025_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Koolhaas_Candice_3_2025_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Koolhaas_Candice_3_2025_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Koolhaas_Candice_3_2025_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="Koolhaas_Candice_3_2025_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="Koolhaas_Candice_3_2025_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="Koolhaas_Candice_3_2025_files/libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="Koolhaas_Candice_3_2025_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="Koolhaas_Candice_3_2025_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="Koolhaas_Candice_3_2025_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="Koolhaas_Candice_3_2025_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="Koolhaas_Candice_3_2025_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="Koolhaas_Candice_3_2025_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Koolhaas_Candice_6_2025</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="complex-linear-models-and-their-design-matrices" class="level2">
<h2 class="anchored" data-anchor-id="complex-linear-models-and-their-design-matrices">1. Complex Linear Models and their Design Matrices</h2>
<p>Get data ready and load libraries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(penguins)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#some incomplete cases to filter out</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sex))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>1A.</strong>&nbsp;First, consider a linear model in which you attempt to predict a penguin’s body mass (<code>body_mass_g</code>) from its flipper length (<code>flipper_length-mm</code>) and the sex (<code>sex</code>) of the penguin.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mass_v_flipper <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm <span class="sc">+</span> sex, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>1B.</strong>&nbsp;Write down the entries in the design matrix,&nbsp;X&nbsp;for the first 3 observations in the data set. Don’t forget the intercept! Verify you are correct with the&nbsp;<code>model.matrix()</code>&nbsp;function.&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>design_matrix <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Flipper =</span> <span class="fu">c</span>(<span class="dv">181</span>, <span class="dv">186</span>, <span class="dv">195</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Male =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(design_matrix, <span class="at">caption =</span> <span class="st">"First 3 Rows of the Design Matrix"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>First 3 Rows of the Design Matrix</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Intercept</th>
<th style="text-align: right;">Flipper</th>
<th style="text-align: right;">Male</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">195</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(mass_v_flipper)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept) flipper_length_mm sexmale
1           1               181       1
2           1               186       0
3           1               195       0</code></pre>
</div>
</div>
<p><strong>1C.</strong>&nbsp;Now, consider adding&nbsp;<code>species</code>&nbsp;to the model in addition to flipper length (<code>flipper_length-mm</code>) and the sex (<code>sex</code>) of the penguin. Fit the model using effects coding.</p>
<p>Write down the entries in the design matrix for the following observations:</p>
<pre><code>penguins[c(1, 2, 200, 201, 300, 301),
c("body_mass_g", "flipper_length_mm", "sex", "species")]</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OK effects coding is different than dummy coding</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell R to use effects coding</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(penguins<span class="sc">$</span>species) <span class="ot">&lt;-</span> contr.sum</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>body_mass_clm <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm <span class="sc">+</span> sex <span class="sc">+</span> species, <span class="at">data =</span> penguins)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>penguins[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">200</span>, <span class="dv">201</span>, <span class="dv">300</span>, <span class="dv">301</span>), </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">c</span>(<span class="st">"body_mass_g"</span>, <span class="st">"flipper_length_mm"</span>, <span class="st">"sex"</span>, <span class="st">"species"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  body_mass_g flipper_length_mm sex    species  
        &lt;int&gt;             &lt;int&gt; &lt;fct&gt;  &lt;fct&gt;    
1        3750               181 male   Adelie   
2        3800               186 female Adelie   
3        4900               217 female Gentoo   
4        5050               220 male   Gentoo   
5        3600               195 male   Chinstrap
6        3900               199 female Chinstrap</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>design_matrix2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Flipper =</span> <span class="fu">c</span>(<span class="dv">181</span>, <span class="dv">186</span>, <span class="dv">217</span>, <span class="dv">220</span>, <span class="dv">195</span>, <span class="dv">199</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Male =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Species =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(design_matrix2, <span class="at">caption =</span> <span class="st">"New Design Matrix"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>New Design Matrix</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Intercept</th>
<th style="text-align: right;">Flipper</th>
<th style="text-align: right;">Male</th>
<th style="text-align: right;">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">217</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">220</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">195</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">199</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(body_mass_clm)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept) flipper_length_mm sexmale species1 species2
1           1               181       1        1        0
2           1               186       0        1        0
3           1               195       0        1        0
4           1               193       0        1        0
5           1               190       1        1        0
6           1               181       0        1        0</code></pre>
</div>
</div>
<p><strong>1D.</strong>&nbsp;Lastly, let’s allow the effect of flipper length to be sex-specific. This can be accomplished by adding an interaction between&nbsp;<code>sex</code>&nbsp;and&nbsp;<code>flipper_length_mm</code>. Again, write down the entries in the design matrix for 6 observations selected just above. Check yourself with&nbsp;<code>model.matrix()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>body_mass_interaction <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm <span class="sc">+</span> sex <span class="sc">+</span> flipper_length_mm<span class="sc">*</span>sex <span class="sc">+</span> species, <span class="at">data =</span> penguins)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>design_matrix3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Flipper =</span> <span class="fu">c</span>(<span class="dv">181</span>, <span class="dv">186</span>, <span class="dv">217</span>, <span class="dv">220</span>, <span class="dv">195</span>, <span class="dv">199</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Male =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Species =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Interaction =</span> <span class="fu">c</span>(<span class="dv">181</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">220</span>, <span class="dv">195</span>, <span class="dv">0</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(design_matrix3, <span class="at">caption =</span> <span class="st">"Interaction Design Matrix"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Interaction Design Matrix</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Intercept</th>
<th style="text-align: right;">Flipper</th>
<th style="text-align: right;">Male</th>
<th style="text-align: right;">Species</th>
<th style="text-align: right;">Interaction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">181</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">217</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">220</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">220</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">195</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">195</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">199</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(body_mass_interaction)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept) flipper_length_mm sexmale species1 species2
1           1               181       1        1        0
2           1               186       0        1        0
3           1               195       0        1        0
4           1               193       0        1        0
5           1               190       1        1        0
6           1               181       0        1        0
  flipper_length_mm:sexmale
1                       181
2                         0
3                         0
4                         0
5                       190
6                         0</code></pre>
</div>
</div>
</section>
<section id="three-variations-on-a-theme" class="level2">
<h2 class="anchored" data-anchor-id="three-variations-on-a-theme">2. Three Variations on a Theme</h2>
<p>For this exercise, we will use the&nbsp;<code>leaftemp</code>&nbsp;data set in the&nbsp;<code>DAAG</code>&nbsp;package. The data set contains measurements of vapor pressure (<code>vapPress</code>) and differences between leaf and air temperatures (<code>tempDiff</code>) in an experiment conducted at three different levels of carbon dioxide (<code>CO2level</code>).</p>
<p><strong>2A.</strong> Fit the following three models to these data:</p>
<ul>
<li><p>simple linear regression: <code>lm(tempDiff ~ vapPress, data = leaftemp)</code></p></li>
<li><p>Analysis of covariance: <code>lm(tempDiff ~ vapPress + CO2level, data= leaftemp)</code></p></li>
<li><p>Interaction model: <code>lm(tempDiff ~ vapPress*CO2level, data= leaftemp)</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(DAAG)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(leaftemp)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(tempDiff <span class="sc">~</span> vapPress, <span class="at">data =</span> leaftemp)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(tempDiff <span class="sc">~</span> vapPress <span class="sc">+</span> CO2level, <span class="at">data=</span> leaftemp)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>lm3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(tempDiff <span class="sc">~</span> vapPress<span class="sc">*</span>CO2level, <span class="at">data=</span> leaftemp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>2B.</strong> Do all of these models pass checks of assumptions?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'performance' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check lm1</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(lm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(lm1))  </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(lm1), <span class="at">col =</span> <span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/2b-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check lm2</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(lm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/2b-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(lm2))  </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(lm2), <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/2b-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check lm3</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(lm3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/2b-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(lm3))  </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(lm3), <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/2b-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>lm1: I think it looks pretty good, but the assumption of equal variance is a bit off, but the regular QQ plot looks OK.</em></p>
<p><em>lm2: Looks even better than lm1.</em></p>
<p><em>lm3: This one is the worst actually. So again the homogeneity of variance is off, and also CO2Level and its interaction effect has high colinearity. BUT in one of our previous lectures, the instructor said that colinearity is actually NOT important for interactions! I guess that makes sense, because of course CO2Level is colinear with its own interaction. So, I actually think this model is AOK too.</em></p>
<p><strong>2C.</strong> For the <strong>Analysis of covariance model</strong>, write down the equation Corresponding to the model. In quarto, you can use LaTeX to write equations fairly simply. Check out this quick primer <a href="https://rmd4sci.njtierney.com/math">here</a> and/or just use this LaTeX equation generator <a href="https://latexeditor.lagrida.com/">here</a>. I promise, it’s super useful!</p>
<ul>
<li><code>lm(tempDiff ~ vapPress + CO2level, data= leaftemp)</code></li>
</ul>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 \text{vapPress}_{i} + \beta_2 \text{CO2 Level}_{i} + \epsilon_i
\]</span></p>
<p><strong>2D</strong>. Plot the predicted mean temperature difference as a function of vapor pressure (and when appropriate, CO2 level) for each of the 3 models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>vap_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(leaftemp<span class="sc">$</span>vapPress), <span class="fu">max</span>(leaftemp<span class="sc">$</span>vapPress), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We only want vapPress and co2</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Because we are predicting the value of temp</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># based on the models</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>pred_data1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">vapPress =</span> vap_seq)  <span class="co"># just has vapPress</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>pred_data2 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">vapPress =</span> vap_seq, <span class="at">CO2level =</span> <span class="fu">unique</span>(leaftemp<span class="sc">$</span>CO2level))  <span class="co"># also has co2</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>pred_data1<span class="sc">$</span>tempDiff <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm1, <span class="at">newdata =</span> pred_data1)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>pred_data2<span class="sc">$</span>tempDiff2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm2, <span class="at">newdata =</span> pred_data2)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>pred_data2<span class="sc">$</span>tempDiff3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm3, <span class="at">newdata =</span> pred_data2)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(leaftemp, <span class="fu">aes</span>(<span class="at">x =</span> vapPress, <span class="at">y =</span> tempDiff)) <span class="sc">+</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data1, <span class="fu">aes</span>(<span class="at">y =</span> tempDiff), </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model 1: tempDiff ~ vapPress"</span>, </span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Vapor Pressure"</span>, <span class="at">y =</span> <span class="st">"Temperature Difference"</span>) <span class="sc">+</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/2d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(leaftemp, <span class="fu">aes</span>(<span class="at">x =</span> vapPress, <span class="at">y =</span> tempDiff, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> <span class="fu">as.factor</span>(CO2level))) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data2, </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> tempDiff2, <span class="at">group =</span> <span class="fu">as.factor</span>(CO2level)), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model 2: tempDiff ~ vapPress + CO2level"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Vapor Pressure"</span>, <span class="at">y =</span> <span class="st">"Temperature Difference"</span>, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"CO2 Level"</span>) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/2d-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(leaftemp, <span class="fu">aes</span>(<span class="at">x =</span> vapPress, <span class="at">y =</span> tempDiff, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> <span class="fu">as.factor</span>(CO2level))) <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data2, <span class="fu">aes</span>(<span class="at">y =</span> tempDiff3, <span class="at">group =</span> <span class="fu">as.factor</span>(CO2level)), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model 3: tempDiff ~ vapPress * CO2level"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Vapor Pressure"</span>, <span class="at">y =</span> <span class="st">"Temperature Difference"</span>, </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"CO2 Level"</span>) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/2d-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interactions-with-continuous-variables" class="level2">
<h2 class="anchored" data-anchor-id="interactions-with-continuous-variables">3. Interactions with Continuous Variables</h2>
<p>Scientists wanted to simulate how different biological interactions might influence the carbon burial potential of sinking algae in the deep ocean. Let’s use&nbsp;<a href="https://biol607.github.io/homework/data/c_burial_sims.csv">this simulated data</a>&nbsp;which features sinking rate, microbial abundance, and detritovore abundance as predictors of net carbon sequestration.</p>
<p><strong>3A</strong> Load the data, inspect it, and fit a model with a 3-way interaction, Do you meet assumptions?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/c_burial_sims.csv"</span>, <span class="at">show_col_types =</span> F)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   sink_rate      microbial_abundance detritivore_biomass
 Min.   :0.0000   Min.   :0.0000      Min.   :0.000      
 1st Qu.:0.9284   1st Qu.:0.7603      1st Qu.:1.187      
 Median :2.0903   Median :1.7456      Median :2.462      
 Mean   :2.0379   Mean   :1.7807      Mean   :2.169      
 3rd Qu.:3.3687   3rd Qu.:2.8463      3rd Qu.:3.224      
 Max.   :3.9231   Max.   :3.9172      Max.   :3.970      
 net_carbon_sequestration
 Min.   :-8.2907         
 1st Qu.:-3.1387         
 Median :-0.7046         
 Mean   :-0.5413         
 3rd Qu.: 1.4131         
 Max.   :11.1405         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'patchwork' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> sink_rate)) <span class="sc">+</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> microbial_abundance)) <span class="sc">+</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>h3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> detritivore_biomass)) <span class="sc">+</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>h4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> net_carbon_sequestration)) <span class="sc">+</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="st">"purple"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>(h1 <span class="sc">+</span> h2) <span class="sc">/</span> (h3 <span class="sc">+</span> h4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/3a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>int_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(sink_rate <span class="sc">~</span> detritivore_biomass<span class="sc">*</span>microbial_abundance<span class="sc">*</span>net_carbon_sequestration, <span class="at">data =</span> data)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(int_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/3a-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>No it does not. The model-predicted values are double-peaked and the observed values are single peaked, which definitely is clue to the model not fitting well. Seems like the linearity assumption is also violated, and homogeneity of variance. Weird stuff going on with multicolinearity too.</em></p>
<p><strong>3B</strong> Now the fun part - inference. What do the coefficients tell you?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(int_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  term                                     estimate std.error statistic  p.value
  &lt;chr&gt;                                       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)                               4.02       0.374     10.8   6.09e-18
2 detritivore_biomass                      -0.538      0.139     -3.86  2.12e- 4
3 microbial_abundance                      -0.852      0.172     -4.95  3.32e- 6
4 net_carbon_sequestration                  0.586      0.0823     7.12  2.33e-10
5 detritivore_biomass:microbial_abundance   0.236      0.0644     3.67  4.06e- 4
6 detritivore_biomass:net_carbon_sequestr… -0.0741     0.0295    -2.51  1.37e- 2
7 microbial_abundance:net_carbon_sequestr… -0.109      0.0320    -3.41  9.53e- 4
8 detritivore_biomass:microbial_abundance… -0.00892    0.0109    -0.821 4.14e- 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> detritivore_biomass, <span class="at">y =</span> sink_rate)) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Simple Effect of Detritivore Biomass on Sink Rate"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Detritivore Biomass"</span>, <span class="at">y =</span> <span class="st">"Sink Rate"</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/3b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> microbial_abundance, <span class="at">y =</span> sink_rate)) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"lightgreen"</span>) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Simple Effect of Microbial Abundance on Sink Rate"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Microbial Abundance"</span>, <span class="at">y =</span> <span class="st">"Sink Rate"</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/3b-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> net_carbon_sequestration, <span class="at">y =</span> sink_rate)) <span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"pink"</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Simple Effect of Net Carbon Sequestration on Sink Rate"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Net Carbon Sequestration"</span>, <span class="at">y =</span> <span class="st">"Sink Rate"</span>) <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/3b-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>So I made plots of the simple effects because my lecture notes say to always plot before trying to make sense of an interaction… but it seems that all else being equal, detritivore_biomass and microbial_abundance reduce sink_rate and net_carbon_sequesteration increases it, but that they all interact with each other, so we should take the simple effects with a grain of salt.</em></p>
<p><strong>3C</strong>&nbsp;OK - that’s a lot. Use your skills of visualization do tease out what the data is telling us. You can use&nbsp;<code>visreg()</code>&nbsp;or&nbsp;<code>augment()</code>&nbsp;with&nbsp;<code>data_grid()</code>&nbsp;or whatever you would like. Make this model make sense so that you can tell your audience how these three parameters work together to influence carbon burial!</p>
<p><em>Oof, so we need to show how the effect of detritive biomass on sink rate is dependent upon microbial abundance and net carbon sequestration. Let’s indeed use visreg() to see some 2 way interactions first:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'visreg' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(int_mod, <span class="st">"detritivore_biomass"</span>, </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">by =</span> <span class="st">"microbial_abundance"</span>, </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">cond =</span> <span class="fu">list</span>(<span class="at">net_carbon_sequestration =</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">mean</span>(data<span class="sc">$</span>net_carbon_sequestration)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/3c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(int_mod, <span class="st">"detritivore_biomass"</span>, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">by =</span> <span class="st">"net_carbon_sequestration"</span>, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">cond =</span> <span class="fu">list</span>(<span class="at">microbial_abundance =</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">mean</span>(data<span class="sc">$</span>microbial_abundance)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Koolhaas_Candice_3_2025_files/figure-html/3c-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>So, when microbial abundance is low, detritivore biomass makes sink rate go down, but when microbial abundance is high, biomass makes sink rate go up. And when carbon sequestration is low, biomass makes sink rate go up but when carbon is high then biomass makes sink rate go down.</em></p>
<p><em>The only way I can think to visualize a 3 way interaction is a 3d plot:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plotly'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    last_plot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(data, <span class="at">x =</span> <span class="sc">~</span>detritivore_biomass, <span class="at">y =</span> <span class="sc">~</span>microbial_abundance, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">z =</span> <span class="sc">~</span>sink_rate, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="sc">~</span>net_carbon_sequestration, </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"scatter3d"</span>, <span class="at">mode =</span> <span class="st">"markers"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"How 3 variables affect Sink Rate"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">scene =</span> <span class="fu">list</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Detritivore Biomass"</span>),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Microbial Abundance"</span>),</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Sink Rate"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b972edb3546651b4e656" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b972edb3546651b4e656">{"x":{"visdat":{"6a70216d2f23":["function () ","plotlyVisDat"]},"cur_data":"6a70216d2f23","attrs":{"6a70216d2f23":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"How 3 variables affect Sink Rate","scene":{"xaxis":{"title":"Detritivore Biomass"},"yaxis":{"title":"Microbial Abundance"},"zaxis":{"title":"Sink Rate"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[3.213036690838635,3.6927649341523647,2.563928523100913,3.7692811377346511,1.5025345245376229,3.2985787019133568,3.2886431952938437,2.6205467591062188,0.42533330898731941,3.5248346775770187,1.3110386673361063,3.390854318626225,0.01414927747100591,2.2907266104593873,0.91101140622049559,1.4597582714632154,1.4378460021689534,1.5188755001872778,3.4090019147843118,3.6241714609786868,0.80270313937216997,3.1531734727323055,1.3312820391729474,0.32252232171595097,1.2923278985545039,0.72982318513095379,3.2608072645962238,1.2521781297400594,0.43837346695363522,3.9697128543630238,2.5761507730931044,1.058061633259058,0.53714948892593384,0.8605418624356389,1.490519342944026,0.2907751789316535,0.47571873106062412,3.3148994399234653,3.2568515846505761,1.9758418863639235,0,2.5952219143509865,2.6933241151273251,0.73693483043462038,2.7116274330765009,2.4825621983036399,3.1923986980691552,3.7050933884456754,2.8709238404408097,1.4430092088878157,2.8434215374290943,0.44239116832613945,3.8615908799692988,0.16072443872690201,1.8564968276768925,2.969690741039813,2.5777168460190296,2.7919194605201483,1.2632076572626829,3.3958144159987569,0.35021621827036142,2.184631934389472,3.6824444103986025,0.772437016479671,3.4504723120480776,2.8726541614159942,1.4817543122917414,1.3180048922076819,2.4420367889106274,0.033805755898356438,3.024058380164206,3.1416443381458521,2.0765499919652939,2.739576124586165,3.5894435038790107,1.1168510867282748,0.30250425729900599,1.8705369047820568,3.7975454227998857,1.2026468031108379,3.073313957080245,3.085866560228169,2.6798480795696378,0.62470649275928736,1.9919700166210532,2.2669022465124726,2.7948246616870165,3.9226877875626087,2.9247726583853364,2.8025755686685443,0.80943895410746336,3.8642345871776342,3.9316270863637328,3.6436693659052257,3.2792307659983635,2.0001016715541482,2.3640764206647873,1.1414965279400349,3.9688702216371894,0.029345809482038021],"y":[3.4270986393094063,0.11924622394144536,0.38039239589124918,0,0.4222510177642107,3.7378143798559904,0.061388889327645302,3.059755089692771,1.2220342112705112,2.3409552639350295,2.842902073636651,1.2993103824555874,0.44382800627499819,3.531308613717556,2.4218748994171619,2.322192226536572,2.342865546233952,2.2554876767098904,0.36417844146490097,0.48371605481952429,1.7557272855192425,1.3037788961082697,2.2961863959208131,3.034813922829926,2.856485110707581,2.9749478995800018,1.5383089883252978,0.36751771438866854,2.2783457869663835,1.9513076059520245,1.9653889229521155,2.2306025000289083,0.49448417127132416,1.8905533477663992,1.0218745982274413,1.051322384737432,0.52295241318643093,1.0281113181263208,3.4896917026489973,3.1008401894941926,0.22736152447760105,0.8828554917126894,0.63023790251463652,0.87943035736680031,2.6109203919768333,0.057113579474389553,0.59954490512609482,1.1208608439192176,3.2900364715605974,0.32150817755609751,1.3325093071907761,2.1817975966259837,3.5963689927011728,0.76690769661217928,1.0054566310718656,1.3524263212457299,0.58513043727725744,1.1052035884931684,2.3418412646278739,1.2637902451679111,3.2167872507125139,3.8347395705059171,1.8815851509571075,0.30972879659384489,1.5692532733082771,0.079061065800487995,0.08864121325314045,3.1049522161483765,3.3525085002183914,0.92206347174942482,2.2501988811418414,3.7733818823471665,2.1021694829687476,1.8160965088754892,0.65883904974907637,3.2021675696596503,3.8048160523176193,1.018326822668314,0.74029387161135674,3.0107508534565568,1.2086197743192315,3.2520517101511359,1.7364931860938668,1.7547981217503548,0.099038631655275822,0.25568369310349226,1.1166268261149526,3.8424094384536143,1.4382611196488142,3.3446520306169987,0.63916372880339622,3.6846226034685969,1.5284014260396359,2.1776755861938,2.1692219572141767,1.5008898777887223,3.9171762866899371,2.1498268432915211,2.8594709178432822,2.273934724740684],"z":[0.61745854280889034,3.8877988671883941,3.326778513379395,0.4023486003279686,2.3761429069563742,0.58352486416697502,3.4370191562920809,2.9759756457060575,0.89493333734571934,0.70124844461679459,0.16407624445855618,2.7102907598018646,0.42392640188336372,2.3844978744164109,3.4559806315228343,1.6226237379014492,3.3783303648233418,0.81538905669003725,0.96090288832783699,3.734682597219944,0.99769694544374943,2.002494590356946,1.0652182251214981,3.2769491709768772,2.0935072470456362,1.0305370399728415,1.454581081867218,0.026595510542392731,3.921711470931768,3.6687422636896372,2.2146603390574455,3.9231119761243463,1.9630622640252111,0.84307125676423311,1.680177628993988,3.3807958234101534,3.6218555327504873,2.5870347218587995,1.6715642428025603,0.92419629637151957,0.79540581163018942,1.7091580564156177,3.7060743728652592,3.3877801652997732,3.7980273878201838,3.5948017025366426,2.638202878646553,2.1997180012986064,0.92988374084234238,2.7125893272459507,1.8802154287695885,0.95094469748437405,1.2345982762053609,3.4189109047874808,2.0869940752163529,0.76993824448436499,0.52075391914695501,3.5629954170435667,0.61778316181153059,3.2243542456999421,3.4861091626808047,0.15873052924871445,2.5811638366430998,2.2189562255516648,1.7043435657396913,2.9215241670608521,1.522711512632668,0.23669295012950897,1.0253357654437425,0,1.358565479516983,3.689652482047677,3.3655215632170439,0.4848965005949139,0.92981036007404316,0.98796154279261839,0.54045112151652575,1.5823593698441982,2.4958096798509359,3.2040665401145816,0.21072109695523977,3.4753195745870471,0.40203816350549459,1.0777667220681906,3.3987044030800462,3.911598009057343,3.4390988480299711,0.43467037472873926,1.0310183772817254,3.3808598313480616,3.8716078689321871,3.0654123052954674,0.28563866019248962,0.33152699377387762,3.5493442304432392,2.5689135137945418,2.4672713493928313,2.1507191155105829,2.1259364644065499,3.1725311316549778],"mode":"markers","type":"scatter3d","marker":{"colorbar":{"title":"net_carbon_sequestration","ticklen":2},"cmin":-8.2907304223804363,"cmax":11.140500264826125,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[5.9285488429745108,7.2508864149655361,0.42378233052485159,-6.0895813052624863,-0.18169020704212513,6.9599639051785189,3.7898492150059369,-1.8871752295983939,-5.2778594350668318,1.8190225822231081,-4.2996140054757035,0.63379174340442734,-6.4422027002284219,0.38210069584195477,5.3787777346824477,-1.3353289773134589,2.9642219818004398,-4.9326242905845046,-4.3957353997538196,5.5665334589303423,-3.4865362185168487,-0.39517640787983938,-1.5560284712509622,7.1009087880769961,-0.60376826635049452,-3.87752255042831,-1.4079808482945368,-6.8034153554630512,6.1894027410002561,-4.7160415854628228,-0.45311930135053602,3.6951212664284609,-2.0713560244265183,-3.0478590154474516,-1.7767164530877519,1.6437402399058161,0.9355629816501716,-1.7484372979253378,0.85011351937157853,-0.030186623455506038,-6.2468794798500014,-1.3322082613756066,2.7686158667406295,0.96797121780345163,-1.3727058829753336,2.1863757932210297,0.19442000101145351,-1.5784161521107274,2.2267202671537456,-0.77787945273994874,-0.71888590620652004,-4.1922708019968091,4.0234605270601431,1.371200436138595,-2.9234067203657768,-0.55874253258245232,-4.7204093359159494,0.92094634541503684,-4.4481593181260735,-0.76272745997241009,10.05309644796659,2.2793442557954409,-0.69031785986102301,-4.0671141380910951,-0.11892118502584062,0.40030849241726618,-3.5379260410447761,-4.0720463118879957,1.8145980040310512,-7.117437512106382,-1.0539409965267634,-7.0887177042353526,1.5386596308413174,-2.5853536939292212,-1.1820186447329408,-1.272292777937015,-8.2907304223804363,-3.4112794608361403,0.24897696394077995,2.6893386347009298,-2.4138555215777489,-5.1056502066471916,-2.3156425775587013,-2.413786796142833,-0.43896409547519921,1.7007019825162271,1.2649516269221159,11.140500264826125,-3.4116643309673331,-3.6926265394739377,0.95141058322939798,-7.2594895411910487,-1.0281384265391802,2.5873645519264397,-2.2376039708897024,1.336239737995403,-0.32236476796705693,0.01360509397032827,-1.4850939114511326,4.7413466927468209],"line":{"colorbar":{"title":"","ticklen":2},"cmin":-8.2907304223804363,"cmax":11.140500264826125,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[5.9285488429745108,7.2508864149655361,0.42378233052485159,-6.0895813052624863,-0.18169020704212513,6.9599639051785189,3.7898492150059369,-1.8871752295983939,-5.2778594350668318,1.8190225822231081,-4.2996140054757035,0.63379174340442734,-6.4422027002284219,0.38210069584195477,5.3787777346824477,-1.3353289773134589,2.9642219818004398,-4.9326242905845046,-4.3957353997538196,5.5665334589303423,-3.4865362185168487,-0.39517640787983938,-1.5560284712509622,7.1009087880769961,-0.60376826635049452,-3.87752255042831,-1.4079808482945368,-6.8034153554630512,6.1894027410002561,-4.7160415854628228,-0.45311930135053602,3.6951212664284609,-2.0713560244265183,-3.0478590154474516,-1.7767164530877519,1.6437402399058161,0.9355629816501716,-1.7484372979253378,0.85011351937157853,-0.030186623455506038,-6.2468794798500014,-1.3322082613756066,2.7686158667406295,0.96797121780345163,-1.3727058829753336,2.1863757932210297,0.19442000101145351,-1.5784161521107274,2.2267202671537456,-0.77787945273994874,-0.71888590620652004,-4.1922708019968091,4.0234605270601431,1.371200436138595,-2.9234067203657768,-0.55874253258245232,-4.7204093359159494,0.92094634541503684,-4.4481593181260735,-0.76272745997241009,10.05309644796659,2.2793442557954409,-0.69031785986102301,-4.0671141380910951,-0.11892118502584062,0.40030849241726618,-3.5379260410447761,-4.0720463118879957,1.8145980040310512,-7.117437512106382,-1.0539409965267634,-7.0887177042353526,1.5386596308413174,-2.5853536939292212,-1.1820186447329408,-1.272292777937015,-8.2907304223804363,-3.4112794608361403,0.24897696394077995,2.6893386347009298,-2.4138555215777489,-5.1056502066471916,-2.3156425775587013,-2.413786796142833,-0.43896409547519921,1.7007019825162271,1.2649516269221159,11.140500264826125,-3.4116643309673331,-3.6926265394739377,0.95141058322939798,-7.2594895411910487,-1.0281384265391802,2.5873645519264397,-2.2376039708897024,1.336239737995403,-0.32236476796705693,0.01360509397032827,-1.4850939114511326,4.7413466927468209]}},"frame":null},{"x":[0,3.9697128543630238],"y":[0,3.9171762866899371],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"net_carbon_sequestration","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":-8.2907304223804363,"cmax":11.140500264826125,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[-8.2907304223804363,11.140500264826125],"line":{"color":"rgba(255,127,14,1)"}},"z":[0,3.9231119761243463],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><em>Here are the major patterns, I think:</em></p>
<ul>
<li><p><em>When microbes and biomass is high and carbon is low, sink rate is high</em></p></li>
<li><p><em>When microbes are low and biomass is low and carbon is high, sink rate is high</em></p></li>
<li><p><em>When all three are high, sink rate is low</em></p></li>
<li><p><em>When all three are low, sink rate is also low</em></p></li>
</ul>
<p><em>So this is how I would summarize it: sink rate is high when carbon is high only if microbes and biomass are low, and sink rate is high when carbon is low only when biomass and microbes are high.</em></p>
<section id="meta-1" class="level3">
<h3 class="anchored" data-anchor-id="meta-1">Meta 1</h3>
<p>Where do you think we will go next with models like there?</p>
<p><em>Hopefully no more three way interactions! But many models have at least one interaction. I would say most models in science follow this kind of formula:<br>
y ~ variable1 + variable2 + variable1*variable3 + randomEffect</em></p>
</section>
<section id="meta-2" class="level3">
<h3 class="anchored" data-anchor-id="meta-2">Meta 2</h3>
<p>In particular, what do you find most interesting about intereaction effects? What do you find most intimidating?</p>
<p><em>Interaction effects between more than two variables can stay away from me haha. Otherwise interactions are pretty important, I think I remember someone saying once that every model of natural phenomenon should have an interaction effect.</em></p>
</section>
<section id="meta-3" class="level3">
<h3 class="anchored" data-anchor-id="meta-3">Meta 3</h3>
<p>How do you think you will use complex linear models like these in your own work?</p>
<p><em>In my own work I frequently use multiple regression with interaction effects. We don’t call them “complex” linear models though, but I like how that makes it sound cooler haha.</em></p>
</section>
<section id="meta-4" class="level3">
<h3 class="anchored" data-anchor-id="meta-4">Meta 4</h3>
<p>Now that we have fully explored purely “linear” models, what one question or concern do you still have?</p>
<p><em>I guess my question would be how to tell your data is nonlinear enough to justify using a nonlinear model rather than transforming your data.</em></p>
</section>
<section id="meta-5" class="level3">
<h3 class="anchored" data-anchor-id="meta-5">Meta 5</h3>
<p>How much time did this take you, roughly? Again, I’m trying to keep track that these assignments aren’t killer, more than anything.</p>
<p><em>Probably about 3 hours.</em></p>
</section>
<section id="meta-6" class="level3">
<h3 class="anchored" data-anchor-id="meta-6">Meta 6</h3>
<p>Please give yourself a weak/sufficient/strong assessment on this assigment. Feel free to comment on why.</p>
<p><em>Haha I always rate myself as strong because I know how much time I spent on this and in the life of a grad student, 3 hours is not trivial. I also feel like I understood this homework AOK.</em></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>